---
description: 數據庫相關開發規範 - 修改 database/ 或 schemas 時加載
globs: ["backend/database/**", "backend/schemas.py"]
---

# 數據庫開發規範

## ORM 模型摘要 (9 表)
```
students (id, name, grade, school, target_direction, personality, learning_style)
  ├── ability_profiles (1:1, 17 個 float 分數字段, 各 0-100)
  ├── interest_items (1:N, topic, depth 1-5, category)
  ├── feedback_summaries (1:N, per scenario, strengths/weaknesses/trend/suggestions)
  ├── time_entries (1:N, activity, duration, half_life, benefit_value)
  ├── goals (1:N, scenario, title, description, five_year_vision, hidden_assumptions)
  ├── action_plans (1:N, goal_id FK, core_tasks JSON, support_tasks JSON, status)
  └── learning_records (1:N, module, scenario, question_id FK, content, ai_feedback, score, reflection)

questions (id, scenario, difficulty, subject, title, options JSON, reference_answer, knowledge_tags JSON, solution_hint, scoring_dimensions JSON)
```

## 枚舉類型
- `ScenarioType`: academic, expression, interview
- `DifficultyLevel`: basic, intermediate, challenge
- `SubjectType`: chinese, math, english, physics, chemistry, biology, history, geography, politics
- `ModuleType`: time_compass, choice_navigator, action_workshop, learning_dojo, thinking_forge, talent_growth, review_hub

## 關鍵約定
- 使用 `AsyncSession` + `async with` 模式
- `get_db()` 是 FastAPI Depends 注入的 async generator
- `init_db()` 使用 `create_all` 只建立不存在的表, 絕不覆蓋
- JSON 字段 (options, knowledge_tags, core_tasks 等) 使用 `Column(JSON)`
- 時間戳使用 `datetime.utcnow`
- 新增表時: models.py 定義 → schemas.py 加 Pydantic → router 中使用
